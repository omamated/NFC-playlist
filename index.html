<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFC Playlist Setup</title>
</head>
<body>
    <h1>Set Up Your NFC Playlist</h1>

    <h2>Step 1: Choose Your Music App</h2>
    <button onclick="chooseApp('spotify')">Spotify</button>
    <button onclick="chooseApp('appleMusic')">Apple Music</button>
    <button onclick="chooseApp('youtubeMusic')">YouTube Music</button>

    <h2>Step 2: Enter Your Playlist Link</h2>
    <input type="text" id="playlistUrl" placeholder="Enter your playlist link">
    <button onclick="savePlaylist()">Save Playlist</button>
    
    <p id="status"></p>

    <h2>Step 3: How to Get Your Playlist Link</h2>
    <div id="instructions">
        <h3>How to Get Your Playlist Link:</h3>
        <ol>
            <li><strong>Spotify:</strong> Open Spotify, go to your playlist, and click on the three dots. Choose "Share" > "Copy Playlist Link". Paste it here.</li>
            <li><strong>Apple Music:</strong> Open Apple Music, go to your playlist, tap the three dots, and select "Share Playlist". Copy the link and paste it here.</li>
            <li><strong>YouTube Music:</strong> Open YouTube Music, go to your playlist, click on the three dots, and choose "Share" > "Copy Playlist Link". Paste it here.</li>
        </ol>
    </div>

    <!-- This button will be hidden until the playlist is saved and the app is opened -->
    <button id="changePlaylistButton" style="display: none;" onclick="window.location.href='https://omamated.github.io/NFC-playlist/index.html'">Change Playlist</button>

    <p id="instructionsText">Tap your NFC tag to save your playlist. You can change it anytime by hitting cancel when the asks you to open the app and hit the button above!</p>

    <script>
        let selectedApp = '';

        function chooseApp(app) {
            selectedApp = app;
            alert('You selected ' + app + '. Now enter your playlist link.');
        }

        function savePlaylist() {
            let url = document.getElementById("playlistUrl").value;
            if (url.trim() === "") {
                document.getElementById("status").innerText = "⚠️ Please enter a valid URL!";
                return;
            }

            if (selectedApp === '') {
                document.getElementById("status").innerText = "⚠️ Please select a music app first!";
                return;
            }

            let playlistLink = {
                app: selectedApp,
                url: url
            };

            localStorage.setItem("playlist", JSON.stringify(playlistLink));
            document.getElementById("status").innerText = "✅ Playlist saved! Tap your NFC tag to launch your app.";

            // Show "Change Playlist" button after playlist is saved
            document.getElementById("changePlaylistButton").style.display = "inline";
        }

        function redirectToPlaylist() {
            let playlistData = localStorage.getItem("playlist");
            if (playlistData) {
                let data = JSON.parse(playlistData);
                let app = data.app;
                let url = data.url;
                let deepLink = "";

                // Convert to deep link based on app
                if (app === "spotify") {
                    deepLink = "spotify://playlist/" + extractSpotifyId(url);
                } else if (app === "appleMusic") {
                    deepLink = "music://"; // Simplified, Apple Music doesn't support direct deep links
                } else if (app === "youtubeMusic") {
                    deepLink = "https://music.youtube.com/playlist?list=" + extractYouTubeId(url);
                }

                // Open the playlist in the app
                window.location.href = deepLink;

                // Show "Change Playlist" button after the app is launched
                document.getElementById("changePlaylistButton").style.display = "inline";
            }
        }

        function extractSpotifyId(url) {
            let id = url.split("/playlist/")[1].split("?")[0];
            return id;
        }

        function extractYouTubeId(url) {
            let id = url.split("list=")[1];
            return id;
        }

        // Auto-play if visiting via NFC
        window.onload = function () {
            redirectToPlaylist();
        };
    </script>
</body>
</html>
